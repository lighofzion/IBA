<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>IBA</title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="shortcut icon" href="/assets/img/logo.webp" type="image/x-icon">
  <!-- Favicons -->
  <!-- <link href="assets/img/favicon.png" rel="icon">-->
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">


  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>
<style>
  /* Custom Modal Styling */
  #courseModal .modal-content {
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    padding: 1rem;
  }

  #courseModal .modal-header {
    background-color: #82be73;
    display: flex;
    /* Enables Flexbox */
    justify-content: center;
    /* Centers horizontally */
    align-items: center;
    /* Centers vertically */
    position: relative;
    /* Needed to position the close button correctly */
  }

  #courseModal .btn-close {
    position: absolute;
    top: 50%;
    right: 1rem;
    transform: translateY(-50%);
    /* Vertically centers the close button */
  }

  #courseModal .modal-header h5 {
    flex-grow: 1;
    /* Ensures the title takes up the available space */
    text-align: center;
    margin: 0;
    /* Removes default margins for consistent alignment */
  }

  #courseModal .form-label {
    font-weight: bold;
  }

  #courseModal .form-control,
  #courseModal .form-select {
    margin-bottom: 1rem;
  }

  #courseModal .form-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background-color: #f9f9f9;
  }

  #courseModal .form-section h6 {
    margin-bottom: 1rem;
    color: #333;
    font-weight: 600;
  }

  #courseModal .btn-primary {
    background-color: #71c55d;
    border: none;
    padding: 0.75rem 1.5rem;
  }

  #courseModal .btn-primary:hover {
    background-color: #71c55d;
  }

  @media (max-width: 768px) {
    #courseModal .modal-dialog {
      margin: 1rem;
    }

    #courseModal .form-section {
      padding: 1rem;
    }
  }
</style>

<body class="index-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 class="sitename"><span>International</span> Bible Academy</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html#hero">Home</a></li>
          <!-- <li><a href="index.html#about">About</a></li>
          <li><a href="index.html#services">IBA Studies</a></li>
          <li><a href="index.html#features">Features</a></li>-->
          <li><a href="myvideo.html">Our Videos</a></li>
          <li><a href="aboutus.html#contact">Contact</a></li>
          <li><a href="program.html" class="active">Program</a></li>
          <li><a href="aboutus.html">About Us</a></li>
          <!-- <li class="login-icon">
            <a href="login.html" class="login-link">

              Login
            </a>
          </li> -->
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

  <main class="main">

    <!-- Program Section -->
    <!-- Program Section -->
    <section id="program" class="program section py-5">
      <div class="container">

        <!-- Header Section -->
        <div class="text-center mb-5">
          <h2 class="section-title display-4 fw-bold text-gradient">Transform Your Faith. Elevate Your Life.</h2>
          <p class="section-subtitle fst-italic text-muted">
            Immerse yourself in a world of spiritual growth, dynamic learning, and leadership development with our
            cutting-edge Bible study programs.
          </p>
        </div>

        <!-- Program Overview -->
        <div class="row align-items-center gy-4">
          <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
            <h3 class="fw-bold text-dark">What We Offer</h3>
            <p class="fst-italic text-muted">
              Unlock deep insights into Scripture, theology, and faith with a tailored online experience. Whether you’re
              looking for personal spiritual growth or to take your leadership skills to the next level, our flexible
              courses are designed for your unique journey.
            </p>
            <ul class="list-unstyled mt-3 text-muted">
              <li><i class="fas fa-check-circle text-success me-2"></i> Study at your pace, from anywhere, anytime</li>
              <li><i class="fas fa-check-circle text-success me-2"></i> Expert guidance with a cutting-edge learning
                platform</li>
              <li><i class="fas fa-check-circle text-success me-2"></i> Earn globally recognized certifications to
                elevate your future</li>
            </ul>
          </div>
          <div class="col-lg-6" data-aos="zoom-in" data-aos-delay="200">
            <img src="assets/img/BibleStudy1.jpg"
              style="max-height: 300px; width: 100%; object-fit: cover; border-radius: 20px;"
              class="img-fluid shadow-lg border border-light" alt="Explore Our Bible Study Program">
          </div>
        </div>


    </section>


    <section id="courses" class="courses section py-5">
      <div class="container">
        <!-- Header Section -->
        <div class="text-center mb-5">
          <h2 class="section-title display-4 fw-bold text-gradient">Our Bible Courses</h2>
          <p class="section-subtitle fst-italic text-muted">
            Enhance your understanding of the Scriptures through our well-structured Bible study courses.
          </p>
        </div>

        <!-- Course Cards -->
        <div class="row gy-4">

          <!-- Course Card 1 -->
          <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
            <div class="card border-0 shadow rounded">
              <img src="assets/img/course3.webp" class="card-img-top rounded-top" alt="Bible Study Basics">
              <div class="card-body">
                <h4 class="card-title fw-bold">Bible Study Basics</h4>
                <p class="card-text text-muted">
                  A foundational course covering key themes and stories in the Bible, perfect for beginners starting
                  their faith journey.
                </p>
                <a href="#" class="btn btn-outline-primary course-details" data-course="Bible Study Basics"
                  data-description="A foundational course covering key themes and stories in the Bible, perfect for beginners starting their faith journey.">Course
                  Details →</a>
              </div>
            </div>
          </div>

          <!-- Course Card 2 -->
          <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="200">
            <div class="card border-0 shadow rounded">
              <img src="assets/img/course2.webp" class="card-img-top rounded-top" alt="Old Testament Studies">
              <div class="card-body">
                <h4 class="card-title fw-bold">Old Testament Studies</h4>
                <p class="card-text text-muted">
                  Dive deep into the Old Testament, exploring the history, prophecies, and wisdom literature that shaped
                  biblical faith.
                </p>
                <a href="#" class="btn btn-outline-primary course-details" data-course="Old Testament Studies"
                  data-description="Dive deep into the Old Testament, exploring the history, prophecies, and wisdom literature that shaped biblical faith.">Course
                  Details →</a>
              </div>
            </div>
          </div>

          <!-- Course Card 3 -->
          <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="300">
            <div class="card border-0 shadow rounded">
              <img src="assets/img/course1.webp" class="card-img-top rounded-top" alt="New Testament Insights">
              <div class="card-body">
                <h4 class="card-title fw-bold">New Testament Insights</h4>
                <p class="card-text text-muted">
                  Learn about the life of Jesus, the growth of the early church, and key theological teachings in the
                  New Testament.
                </p>
                <a href="#" class="btn btn-outline-primary course-details" data-course="New Testament Insights"
                  data-description="Learn about the life of Jesus, the growth of the early church, and key theological teachings in the New Testament.">Course
                  Details →</a>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Call to Action -->
      <div class="text-center mt-5">
        <a href="#enroll" class="btn btn-primary btn-lg px-5 py-3 rounded-3 shadow-lg" data-bs-toggle="modal"
          data-bs-target="#courseModal">Apply Today</a>
      </div>
      </div>
    </section>

    <!-- Modal -->
    <div class="modal fade" id="courseModal" tabindex="-1" aria-labelledby="courseModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="courseModalLabel">Sign Up for the Course</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="courseForm">
              <!-- Personal Details Section -->
              <div class="form-section">
                <h6>Personal Details</h6>
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="name" class="form-label">Full Name / பெயர் <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="name" placeholder="Enter your full name" required>
                    </div>
                    <div class="mb-3">
                      <label for="phone_number" class="form-label">Phone Number / தொலைபேசி <span
                          class="text-danger">*</span></label>
                      <input type="tel" class="form-control" id="phone_number" placeholder="Enter your phone number"
                        pattern="[0-9]{10}" required>
                    </div>
                    <div class="mb-3">
                      <label for="email" class="form-label">Email / மின்னஞ்சல்</label>
                      <input type="email" class="form-control" id="email" placeholder="Enter your email">
                    </div>
                    <div class="mb-3">
                      <label for="city" class="form-label">City / நகரம் <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="city" placeholder="Enter your city" required>
                    </div>
                    <div class="mb-3">
                      <label for="job_occupation" class="form-label">Occupation / தொழில் <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="job_occupation" placeholder="Enter your occupation"
                        required>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="gender" class="form-label">Gender / பாலினம் <span class="text-danger">*</span></label>
                      <select class="form-select" id="gender" required>
                        <option value="" selected disabled>Select your gender</option>
                        <option value="Male">Male / ஆண்</option>
                        <option value="Female">Female / பெண்</option>
                        <option value="Other">Other / மற்றவை</option>
                        <option value="Prefer not to say">Prefer not to say / கூற விரும்பவில்லை</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="marital_status" class="form-label">Marital Status / திருமண நிலை <span
                          class="text-danger">*</span></label>
                      <select class="form-select" id="marital_status" required>
                        <option value="" selected disabled>Select your marital status</option>
                        <option value="Single">Single / ஒற்றை</option>
                        <option value="Married">Married / திருமணமானவர்</option>
                        <option value="Widowed">Widowed / விதவா</option>
                        <option value="Divorced">Divorced / விவாகரத்து</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="birthdate" class="form-label">Birthdate / பிறந்த தேதி <span
                          class="text-danger">*</span></label>
                      <input type="date" class="form-control" id="birthdate" required>
                    </div>
                    <div class="mb-3">
                      <label for="district" class="form-label">District / மாவட்டம் <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="district" placeholder="Enter your district" required>
                    </div>
                    <div class="mb-3">
                      <label for="state" class="form-label">State / மாநிலம் <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="state" placeholder="Enter your state" required>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Course Details Section -->
              <div class="form-section">
                <h6>Course Details</h6>
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="course_language" class="form-label">Course Language / மொழி<span
                          class="text-danger">*</span></label>
                      <select class="form-select" id="course_language" required>
                        <option value="" selected disabled>Select a language</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="course_type" class="form-label">Course Type / பாடநாள்<span
                          class="text-danger">*</span></label>
                      <select class="form-select" id="course_type" required>
                        <option value="" selected disabled>Select from choice</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="nationality" class="form-label">Nationality / குடியுரிமை <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="nationality" placeholder="Enter your nationality"
                        required>
                    </div>
                    <div class="mb-3">
                      <label for="years_of_faith" class="form-label">Years of Faith / விசுவாச ஆண்டுகள்<span
                          class="text-danger">*</span></label>
                      <input type="number" class="form-control" id="years_of_faith" placeholder="Enter years of faith"
                        min="0">
                    </div>

                  </div>
                  <div class="mb-3" style="position: relative;">
                    <label for="referral" class="form-label">Referral Name (Optional)</label>
                    <input type="text" class="form-control" id="referral" placeholder="Start typing a referral name...">
                    <ul id="suggestionsList" class="suggestions-list"></ul>
                  </div>
                </div>
              </div>

              <!-- Additional Information Section -->
              <div class="form-section">
                <h6>Additional Information</h6>
                <div class="mb-3">
                  <label for="additional_info" class="form-label">Additional Information / கூடுதல் தகவல்</label>
                  <textarea class="form-control" id="additional_info" rows="3"
                    placeholder="Share any specific expectations or questions..."></textarea>
                </div>
              </div>

              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="consent" required>
                <label class="form-check-label" for="consent">
                  I agree to the <a href="#" data-bs-toggle="collapse" data-bs-target="#termsCollapse"
                    aria-expanded="false" aria-controls="termsCollapse">terms and conditions</a>
                </label>
              </div>
              <!-- Collapsible Section for Terms and Conditions -->
              <div class="collapse" id="termsCollapse">
                <div class="alert alert-info" role="alert">
                  <div class="card card-body">
                    <h6>Terms and Conditions</h6>
                    <p>
                      By signing up for this course, you agree to the following:
                    </p>
                    <ul>
                      <li>You will attend classes regularly.</li>
                      <li>You consent to the collection of personal information for communication purposes.</li>
                      <li>You may withdraw your consent at any time by contacting us.</li>
                      <li>
                        Our students come from various parts of the world, from various religions and denominations.
                        To better assist you in the course, we want to get to know you.
                      </li>
                      <li>
                        The following personal and basic information is required for enrollment in the education center,
                        which will allow you to participate in the basic, intermediate, and advanced levels of Bible
                        study
                        classes.
                      </li>
                      <li>
                        These informations will not transfer to any other person/institution and will be protected.
                      </li>
                      <li>
                        For further details, please contact support.
                    </ul>

                  </div>
                </div>
              </div>


              <button id="submitBtn" class="btn btn-primary">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="consentModal" tabindex="-1" aria-labelledby="consentModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="consentModalLabel">Terms and Conditions</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>
              <!-- Add your terms and conditions content here -->
              By signing up for this course, you agree to our privacy policy, course guidelines, and other related
              terms.
            </p>
            <ul>
              <li>You agree to attend the course regularly.</li>
              <li>You consent to the collection of personal information for course-related communication.</li>
              <li>You may withdraw your consent at any time by contacting support.</li>
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>


    <!-- Success Modal (for successful registration) -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="successModalLabel">Successfully Registered</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Congratulations! You have successfully registered for the course. Someone will contact you soon!</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal (for already registered user) -->
    <div class="modal fade" id="alreadyRegisteredModal" tabindex="-1" aria-labelledby="alreadyRegisteredModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="alreadyRegisteredModalLabel">Already Registered</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>You are already registered for this course. Someone will contact you soon!</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>



  </main>



  <footer id="footer" class="footer light-background">

    <div class="container">
      <div class="copyright text-center ">
        <p>© <span>Copyright</span> <strong class="px-1 sitename">IBA</strong> <span>All Rights Reserved</span></p>
      </div>
      <div class="social-links d-flex justify-content-center">
        <a href=""><i class="bi bi-twitter-x"></i></a>
        <a href=""><i class="bi bi-facebook"></i></a>
        <a href=""><i class="bi bi-instagram"></i></a>
        <a href=""><i class="bi bi-linkedin"></i></a>
      </div>
      <!-- <div class="credits">
        Designed by <a href="#">IBA Team</a>
      </div> -->
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <script type="module">
    const supabaseUrl = "https://lqugerdmxqpvigfchfgz.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxdWdlcmRteHFwdmlnZmNoZmd6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNTcwOTY1OCwiZXhwIjoyMDUxMjg1NjU4fQ.rYe9asgVqtbiJmPJwb30THyM913FYwrMAnGHm_4AEDY";

    if (!supabaseUrl || !supabaseKey) {
      console.error('Supabase configuration is missing');
    }

    let supabaseClient;
    try {
      supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
    } catch (error) {
      console.error('Error initializing Supabase client:', error);
      // Fallback handling when Supabase initialization fails
      supabaseClient = {
        from: () => ({
          select: () => Promise.resolve({ data: [], error: null }),
          insert: () => Promise.resolve({ data: [], error: null })
        })
      };
    }
    // Utility function to clear dropdown and set default options
    function resetDropdown(dropdownId, defaultText) {
      const dropdown = document.getElementById(dropdownId);
      dropdown.innerHTML = `<option value="" selected disabled>${defaultText}</option>`;
    }

    // Function to populate dropdowns
    function populateDropdown(dropdownId, data, valueKey) {
      const dropdown = document.getElementById(dropdownId);
      const uniqueValues = new Set(); // To keep track of unique values

      data.forEach(item => {
        const value = item[valueKey];
        if (value && !uniqueValues.has(value)) {
          uniqueValues.add(value); // Add to the set
          const option = document.createElement('option');
          option.value = value;
          option.textContent = value;
          dropdown.appendChild(option);
        }
      });
    }


    // Fetch course details from Supabase and populate dropdowns
    async function fetchCourseDetails() {
      try {
        const { data, error } = await supabaseClient
          .from('dim_batches')
          .select('batch_days, batch_lang');

        if (error) throw new Error(error.message);

        console.log('Fetched data:', data);

        // Clear previous options
        resetDropdown('course_type', 'Select from choice');
        resetDropdown('course_language', 'Select a language');

        // Populate Course Days and Language dropdowns
        if (data && data.length > 0) {
          populateDropdown('course_type', data, 'batch_days');
          populateDropdown('course_language', data, 'batch_lang');
        } else {
          console.log('No data available');
        }
      } catch (err) {
        console.error('Error fetching course details:', err);
      }
    }

    // Fetch referral names
    async function fetchReferralNames() {
      const referralNames = [];
      try {
        const { data, error } = await supabaseClient
          .from('networker')
          .select('Name');

        if (error) throw new Error(error.message);

        referralNames.push(...data.map(item => item.Name));
        return referralNames;
      } catch (err) {
        console.error('Error fetching referral names:', err);
        return referralNames;
      }
    }

    // Handle modal show event to fetch course details
    function handleModalShow() {
      const modalElement = document.getElementById('courseModal');
      if (modalElement) {
        modalElement.addEventListener('show.bs.modal', () => {
          console.log('Modal is now open');
          fetchCourseDetails();
        });
      }
    }

    // Listen for input and filter referral names
    async function handleReferralInput(event) {
      const referralNames = await fetchReferralNames();
      const input = event.target.value;
      const suggestionsList = document.getElementById('suggestionsList');

      if (input.length > 1) {
        const filteredNames = referralNames.filter(name =>
          name.toLowerCase().includes(input.toLowerCase())
        );

        suggestionsList.innerHTML = '';
        filteredNames.forEach(name => {
          const li = document.createElement("li");
          li.textContent = name;
          li.onclick = () => {
            document.getElementById("referral").value = name;
            suggestionsList.innerHTML = '';
          };
          suggestionsList.appendChild(li);
        });
      } else {
        suggestionsList.innerHTML = '';
      }
    }

    // Handle form submission
    async function handleFormSubmission(e) {
      e.preventDefault();
      const studentData = {
        name: document.getElementById('name')?.value || null,
        phone_number: document.getElementById('phone_number')?.value || null,
        email: document.getElementById('email')?.value || null,
        networker: document.getElementById('referral')?.value || null,
        city: document.getElementById('city')?.value || null,
        district: document.getElementById('district')?.value || null,
        state: document.getElementById('state')?.value || null,
        nationality: document.getElementById('nationality')?.value || null,
        birthdate: document.getElementById('birthdate')?.value || null,
        job_occupation: document.getElementById('job_occupation')?.value || null,
        gender: document.getElementById('gender')?.value || null,
        marital_status: document.getElementById('marital_status')?.value || null,
        years_of_faith: parseInt(document.getElementById('years_of_faith')?.value) || null,
        course_type: document.getElementById('course_type')?.value || null,
        course_language: document.getElementById('course_language')?.value || null,
        additional_info: document.getElementById('additional_info')?.value || null
      };

      const isDuplicate = await checkDuplicateStudent(studentData.phone_number);

      if (isDuplicate) {
        $('#courseModal').modal('hide');
        $('#alreadyRegisteredModal').modal('show');
        return;
      }

      const isSuccessful = await insertStudentData(studentData);
      if (isSuccessful) {
        $('#courseModal').modal('hide');
        $('#successModal').modal('show');
      }
    }

    // Check for duplicate student
    async function checkDuplicateStudent(phoneNumber) {
      try {
        const { data, error } = await supabaseClient
          .from('restricted_udl_students')
          .select('*')
          .eq('phone_number', phoneNumber);

        if (error) throw new Error(error.message);
        return data && data.length > 0;
      } catch (err) {
        console.error('Error checking for duplicate student:', err);
        return false;
      }
    }

    // Insert student data into Supabase
    async function insertStudentData(studentData) {
      try {
        const { data, error } = await supabaseClient
          .from('restricted_udl_students')
          .insert([studentData]);

        if (error) throw new Error(error.message);
        return true;
      } catch (err) {
        console.error('Error inserting student:', err);
        alert('An unexpected error occurred. Please try again.');
        return false;
      }
    }

    function setupModalCloseListeners() {
      // Only reload when success modal is hidden, ensuring the form is not shown again
      $('#successModal').on('hidden.bs.modal', () => {
        console.log('Success modal closed, reloading page');
        if (!window.location.hash.includes('registration')) {
          location.reload();
        }
      });

      // Ensure the already registered modal also triggers only once for reload
      $('#alreadyRegisteredModal').on('hidden.bs.modal', () => {
        console.log('Already registered modal closed, reloading page');
        setTimeout(() => {
          if (!window.location.hash.includes('registration')) {
            location.reload();
          }
        }); // Delayed reload to ensure it's not triggered prematurely
      });
    }

    // Check if the page should reset and show the registration modal
    function checkRegistrationHash() {
      if (window.location.hash === '#registration') {
        console.log('Hash is #registration, showing course modal');
        document.getElementById('courseForm').reset();
        document.getElementById('suggestionsList').innerHTML = '';
        const registrationModal = new bootstrap.Modal(document.getElementById('courseModal'));

        // Ensure it's not being shown multiple times
        if (!$('#courseModal').hasClass('show')) {
          registrationModal.show();
        }
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      handleModalShow();
      document.getElementById('referral').addEventListener('input', handleReferralInput);
      document.getElementById('courseForm').addEventListener('submit', handleFormSubmission);
      setupModalCloseListeners();
      checkRegistrationHash();
      AOS.init();
    });

    var consentCheckbox = document.getElementById('consent');
    var termsLink = document.querySelector('a[data-bs-toggle="collapse"]');

    consentCheckbox.addEventListener('change', function () {
      if (this.checked) {
        termsLink.setAttribute('aria-expanded', 'true');
        document.getElementById('termsCollapse').classList.add('show');
      } else {
        termsLink.setAttribute('aria-expanded', 'false');
        document.getElementById('termsCollapse').classList.remove('show');
      }
    });
  </script>

</body>

</html>
